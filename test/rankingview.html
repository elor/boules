<!DOCTYPE html>
<!-- Note to self: don't autoformat this file using eclipse/aptana! It introduces unwanted visible spaces -->
<html lang="de">
<head>
<meta charset="utf-8" />
<title>Tuvero Test 1.5.10</title>
<link rel="shortcut icon" href="images/favicon.png" type="image/png" />
<link rel="stylesheet" href="style/main.css" />
<style>
  td {
    white-space: nowrap;
  }
</style>
</head>

<body>
  <table class="rankingview">
    <tr class="rankingheader">
      <th>Platz</th>
      <th>No.</th>
      <th class="playername">Name</th>
      <th class="component">%% %%</th>
    </tr>
    <tr class="rankingrow template">
      <td class="rank">##</td>
      <td class="teamno">##</td>
      <td class="playername"></td>
      <td class="component">##</td>
    </tr>
  </table>

  <script id="testmain">
  function TestMain(Common, $) {
    var RankingView, RankingModel, TeamModel, MatchResult, ListModel;

    RankingView = Common('ui/rankingview');
    RankingModel = Common('ranking/rankingmodel');
    TeamModel = Common('ui/teammodel');
    PlayerModel = Common('ui/playermodel');
    ValueModel = Common('core/valuemodel');
    ListModel = Common('list/listmodel');
    MatchModel = Common('core/matchmodel');
    MatchResult = Common('core/matchresult');

    $(function($) {
      var ranking, $view, i, teamlist, teams;

      ranking = new RankingModel(['wins', 'buchholz', 'finebuchholz', 'sonneborn',
        'saldo', 'points'], 64);

      teamlist = new ListModel();
      for (i = 0; i < ranking.length; i += 1){
        teams = [];
        do {
          teams.push(new PlayerModel('Player ' + i + '.' + (teams.length+1)));
        } while (Math.random() < (1.0/(teams.length+1)));
        teamlist.push(new TeamModel(teams));
      }

      $view = $('table');
      view = new RankingView(ranking, $view, teamlist, new ValueModel(false));

      for ( i=0; i<ranking.length * 10; i+=1 ) {
        window.setTimeout(function() {
          var a, b, p, q;
          a = Math.floor(Math.random()*ranking.length);
          b = Math.floor(Math.random()*(ranking.length - 1));
          if (b >= a){
            b += 1;
          }
          p = 8 * Math.floor(Math.random()*5);
          q = 8 * Math.floor(Math.random()*5);
          if (p === q){
            if (Math.random() >= 0.5) {
              p += 1;
            } else {
              q += 1;
            }
          }
          ranking.result(new MatchResult(new MatchModel([a,b]), [p,q]));
        }, 12*i);
      }
    });
  }
  </script>
  <script data-main="scripts/main.js" src="scripts/require.js"></script>
</body>
</html>
